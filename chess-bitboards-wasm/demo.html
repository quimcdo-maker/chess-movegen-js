<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chess Bitboards WASM Demo</title>
    <style>
        body { font-family: monospace; padding: 20px; max-width: 800px; margin: 0 auto; }
        h1 { color: #333; }
        .test { margin: 10px 0; padding: 10px; background: #f0f0f0; border-radius: 4px; }
        .pass { background: #d4edda; color: #155724; }
        .fail { background: #f8d7da; color: #721c24; }
        button { padding: 10px 20px; font-size: 16px; cursor: pointer; }
        #output { white-space: pre-wrap; }
    </style>
</head>
<body>
    <h1>ðŸ¦€ Chess Bitboards WASM Demo</h1>
    <button onclick="runTests()">Run Tests</button>
    <div id="output"></div>

    <script type="module">
        import init, { 
            popcount64, 
            lsb64, 
            msb64,
            knight_attacks,
            king_attacks,
            rook_attacks,
            bishop_attacks,
            white_pawn_attacks,
            black_pawn_attacks,
            square_to_algebraic,
            algebraic_to_square,
            ChessBitboardEngine
        } from './pkg/chess_bitboards_wasm.js';

        await init();

        window.runTests = function() {
            const output = document.getElementById('output');
            output.innerHTML = '';
            
            function log(msg, pass = null) {
                const div = document.createElement('div');
                div.className = 'test' + (pass === true ? ' pass' : pass === false ? ' fail' : '');
                div.textContent = msg;
                output.appendChild(div);
            }

            log('=== Basic Operations ===');
            
            // Popcount
            const pc = popcount64(0xFFn);
            log(`popcount64(0xFF) = ${pc}`, pc === 8);
            
            // LSB
            const lsb = lsb64(0b1000n);
            log(`lsb64(0b1000) = ${lsb}`, lsb === 3);
            
            // MSB
            const msb = msb64(0b1000n);
            log(`msb64(0b1000) = ${msb}`, msb === 3);
            
            log('\n=== Knight Attacks ===');
            const knightE4 = knight_attacks(28);
            const knightCount = popcount64(knightE4);
            log(`Knight on e4 attacks ${knightCount} squares`, knightCount === 8);
            
            log('\n=== King Attacks ===');
            const kingE4 = king_attacks(28);
            const kingCount = popcount64(kingE4);
            log(`King on e4 attacks ${kingCount} squares`, kingCount === 8);
            
            log('\n=== Rook Attacks ===');
            const rookE4 = rook_attacks(28, 0n);
            const rookCount = popcount64(rookE4);
            log(`Rook on e4 (empty board) attacks ${rookCount} squares`, rookCount === 14);
            
            log('\n=== Bishop Attacks ===');
            const bishopE4 = bishop_attacks(28, 0n);
            const bishopCount = popcount64(bishopE4);
            log(`Bishop on e4 (empty board) attacks ${bishopCount} squares`, bishopCount === 13);
            
            log('\n=== Pawn Attacks ===');
            const wpE4 = white_pawn_attacks(28);
            const wpCount = popcount64(wpE4);
            log(`White pawn on e4 attacks ${wpCount} squares`, wpCount === 2);
            
            const bpE5 = black_pawn_attacks(36);
            const bpCount = popcount64(bpE5);
            log(`Black pawn on e5 attacks ${bpCount} squares`, bpCount === 2);
            
            log('\n=== Square Conversion ===');
            const alg = square_to_algebraic(28);
            log(`square_to_algebraic(28) = "${alg}"`, alg === 'e4');
            
            const sq = algebraic_to_square('e4');
            log(`algebraic_to_square("e4") = ${sq}`, sq === 28);
            
            log('\n=== Engine Tests ===');
            const engine = new ChessBitboardEngine();
            const testOps = engine.test_basic_operations();
            log(`Engine basic operations test: ${testOps ? 'PASS' : 'FAIL'}`, testOps);
            
            const engineKnight = engine.generate_attacks(28, 0n, 2, 0);
            const engineKnightCount = popcount64(engineKnight);
            log(`Engine knight attacks: ${engineKnightCount} squares`, engineKnightCount === 8);
            
            log('\n=== Performance Test ===');
            const iterations = 100000;
            const start = performance.now();
            for (let i = 0; i < iterations; i++) {
                knight_attacks(28);
            }
            const end = performance.now();
            const time = end - start;
            const nps = (iterations / time * 1000).toFixed(0);
            log(`${iterations} knight_attacks in ${time.toFixed(2)}ms = ${nps} ops/sec`);
            
            log('\nâœ… All tests completed!');
        };
    </script>
</body>
</html>
